var CatBase=function(t){function e(){t.call(this),this.addEventListener(egret.Event.COMPLETE,this.completeAction,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.song=function(){this.gotoAndPlay("song",-1)},s.completeAction=function(t){t.target instanceof Cat&&"stand"==this.idleLabel&&this.gotoAndPlay(this.idleLabel,-1)},s.stand=function(){this.gotoAndPlay("stand",-1)},s.shock=function(){this.gotoAndPlay("shock",1)},s.die=function(){this.idleLabel="die",this.gotoAndPlay("die",1)},s.draw=function(t){Data.type==shapeType.HORIZONTAL?(this.startLabel="draw_horizontal",this.idleLabel="stand",this.playDrawMusic(0)):Data.type==shapeType.VERTICAL?(this.startLabel="draw_vertical",this.idleLabel="stand",this.playDrawMusic(1)):Data.type==shapeType.LETTER_V?(this.startLabel="draw_v",this.idleLabel="stand",this.playDrawMusic(2)):Data.type==shapeType.REVERSED_LETTER_V?(this.startLabel="draw_v_inversed",this.idleLabel="stand",this.playDrawMusic(3)):Data.type==shapeType.FLASH&&(this.startLabel="draw_flash",this.idleLabel="stand",this.playDrawMusic(0)),this.gotoAndPlay(this.startLabel,1)},s.playDrawMusic=function(t){var e=RES.getRes("ding_"+t+"_mp3");this._catDrawChannel=e.play(1,1),this._catDrawChannel.volume=1},e}(egret.MovieClip);egret.registerClass(CatBase,"CatBase");var Cat=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("destory_ghosts_json"),e=RES.getRes("destory_ghosts_png"),i=new egret.MovieClipDataFactory(t,e);this.movieClipData=i.generateMovieClipData("cat"),this.anchorOffsetX=this.width/2,this.startLabel="",this.idleLabel="stand"},e}(CatBase);egret.registerClass(Cat,"Cat");var Data=function(){function t(){}var e=__define,i=t;i.prototype;return t.getStageW=function(){return egret.MainContext.instance.stage.stageWidth},t.getStageH=function(){return egret.MainContext.instance.stage.stageHeight},e(t,"stage",function(){return egret.MainContext.instance.stage}),t.type=-1,t.life=5,t.score=0,t.baseSpeed=1,t.baseRandomSpeed=2,t.baseTimer=3e3,t.baseSymbolNum=1,t.baseSymbolRandomNum=0,t.ghostTimes=0,t.flashDetoryStatus=!1,t}();egret.registerClass(Data,"Data");var LoadEvent=function(t){function e(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1),t.call(this,e,i,s)}__extends(e,t);var i=(__define,e);i.prototype;return e}(RES.ResourceEvent);egret.registerClass(LoadEvent,"LoadEvent");var MainEvent=function(t){function e(e,i,s,a){void 0===i&&(i=""),void 0===s&&(s=!1),void 0===a&&(a=!1),t.call(this,e,s,a),this._resName="",this._resName=i}__extends(e,t);var i=__define,s=e,a=s.prototype;return i(a,"resName",function(){return this._resName}),e.OPENLOADBAR="openloadbar",e.REMOVE="remove",e.LOADCOMP="loadcomp",e.QUITGUANKA="quitguanka",e.TRYAGAIN="tryagain",e.GAMEOVER="gameover",e.GAMERESTART="gamerestart",e.GAMEPAUSE="pause",e.GAMEGOON="gameregoon",e.DISTORYACTION="destory_action",e.DISTORYGHOST="destory_ghost",e.FLASHACTION="flash_action",e.ATTACKED="be_attacked",e.DRAWSONG="draw_song",e.CATSTAND="cat_stand",e}(egret.Event);egret.registerClass(MainEvent,"MainEvent");var Game=function(){function t(t){this._layer=t,this.init()}var e=(__define,t),i=e.prototype;return i.init=function(){this.drawBg(),this._gestureShape=new egret.Sprite,this._layer.addChild(this._gestureShape),this._gesture=new GestureShape,this._gesture.addEvent(this._gestureShape),Data.stage.addEventListener(MainEvent.GAMEOVER,this.gameOver,this),Data.stage.addEventListener(MainEvent.ATTACKED,this.beAttacked,this),Data.stage.addEventListener(MainEvent.GAMERESTART,this.restart,this),Data.stage.addEventListener(MainEvent.GAMEPAUSE,this.pauseHandler,this),Data.stage.addEventListener(MainEvent.GAMEGOON,this.goonHandler,this)},i.drawBg=function(){this._background=new Background,this._layer.addChild(this._background),this._pauseButton=new PauseButton,this._layer.addChild(this._pauseButton)},i.pauseHandler=function(){this._time.stop(),this._gesture.removeEvent()},i.goonHandler=function(){this._gesture.addEvent(this._gestureShape),this._time.start()},i.start=function(){this._time=new egret.Timer(Data.baseTimer,0),this._time.addEventListener(egret.TimerEvent.TIMER,this.create,this),this._time.start(),this.playBgMusic()},i.create=function(){var t=10;Data.ghostTimes++,Data.ghostTimes>0&&Data.ghostTimes%t==0&&(t+=10,Math.random()>.5?Data.baseSymbolRandomNum++:Data.baseRandomSpeed++);var e=new GhostContainer;e.alpha=0,this._layer.addChild(e),egret.Tween.get(e).to({alpha:1},2e3,egret.Ease.sineIn)},i.playBgMusic=function(){this._bgsound=RES.getRes("bg_mp3"),this._soundChannel=this._bgsound.play(0,-1),this._soundChannel.volume=.5,egret.log(this._bgsound.length)},i.stopBgMusic=function(){this._soundChannel.stop()},i.gameOver=function(t){this._time.stop(),this._gesture.removeEvent(),this.stopBgMusic(),this._restartButton=new RestartButton,this._layer.addChild(this._restartButton)},i.restart=function(){Data.life=5,Data.score=0,Data.baseSpeed=1,Data.baseRandomSpeed=2,Data.baseTimer=3e3,Data.baseSymbolNum=1,Data.baseSymbolRandomNum=0,Data.ghostTimes=0,this.init(),this.start()},i.beAttacked=function(t){this._background.updateLife(),egret.Tween.get(this._layer).to({x:5,y:5},50).to({x:-5,y:5},50).to({x:5,y:-5},50).to({x:0,y:0},50)},t}();egret.registerClass(Game,"Game");var PauseButton=function(t){function e(){t.call(this),this._sign=!1,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.switchButton(this._sign),this._sign=!0,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pausetGame,this)},s.switchButton=function(t){this._button=new egret.Bitmap,t?this._button.texture=RES.getRes("pause_start_png"):this._button.texture=RES.getRes("pause_png"),this._button.width=58,this._button.height=50,this._button.x=Data.getStageW()-this._button.width-20,this._button.y=Data.getStageH()-this._button.height-20,this.addChild(this._button)},s.pausetGame=function(){this.removeChild(this._button),this.switchButton(this._sign),this._sign=!this._sign,this._sign?Data.stage.dispatchEvent(new MainEvent(MainEvent.GAMEGOON)):Data.stage.dispatchEvent(new MainEvent(MainEvent.GAMEPAUSE))},e}(egret.Sprite);egret.registerClass(PauseButton,"PauseButton");var RestartButton=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.texture=RES.getRes("restart_button_png"),this.x=(Data.getStageW()-this.width)/2,this.y=(Data.getStageH()-this.height)/2,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this)},s.restartGame=function(){Data.stage.dispatchEvent(new MainEvent(MainEvent.GAMERESTART)),this.parent.removeChild(this)},e}(egret.Bitmap);egret.registerClass(RestartButton,"RestartButton");var Ghost=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("destory_ghosts_json"),e=RES.getRes("destory_ghosts_png"),i=new egret.MovieClipDataFactory(t,e);this.movieClipData=i.generateMovieClipData("ghost"),this.gotoAndStop("move")},e}(CatBase);egret.registerClass(Ghost,"Ghost");var GhostBase=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.MovieClip);egret.registerClass(GhostBase,"GhostBase");var GhostContainer=function(t){function e(){t.call(this),this._vx=0,this._vy=0,this._dir=Math.random()>.5?0:1,this._doingDestory=!1,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this._ghost=new Ghost,this.addChild(this._ghost),this.getRandomSymbol(),this.drawSymbol(),this.addEventListener(egret.Event.ADDED,this.added,this),this._ghost.addEventListener(egret.Event.COMPLETE,this.completeHandler,this),Data.stage.addEventListener(MainEvent.DISTORYACTION,this.destoryHandler,this),Data.stage.addEventListener(MainEvent.FLASHACTION,this.flashActionHandler,this),Data.stage.addEventListener(MainEvent.GAMEOVER,this.gameoverHandler,this),Data.stage.addEventListener(MainEvent.GAMEPAUSE,this.pauseHandler,this),Data.stage.addEventListener(MainEvent.GAMEGOON,this.goonHandler,this)},s.drawSymbol=function(){this._shape=new ShapeContainer,this._shape.create(this._symbolList,this._dir),this._shape.x=50,this._shape.y=20,this.addChild(this._shape)},s.pauseHandler=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this)},s.goonHandler=function(){this.parent&&this.addEventListener(egret.Event.ENTER_FRAME,this.move,this)},s.gameoverHandler=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this)},s.redrawSymbol=function(){this._shape.redraw(this._symbolList,this._dir)},s.added=function(t){t.target instanceof e&&(this.x=this._dir?this.width/2:Data.getStageW()-this.width/2,this.y=Math.ceil(Data.getStageH()*Math.random()),this.scaleX*=this._dir?-1:1,this._vx=Data.baseSpeed+Math.ceil(Math.random()*Data.baseRandomSpeed),this._vx*=this._dir?1:-1,this._dir?this._vy=(Data.getStageH()/2-this.y-this.height/2-42)/(Data.getStageW()/2-this.x+this.width/2+52)*this._vx:this._vy=(Data.getStageH()/2-this.y-this.height/2-42)/(Data.getStageW()/2-this.x-this.width/2-52)*this._vx,this.addEventListener(egret.Event.ENTER_FRAME,this.move,this))},s.move=function(t){this.hitPointTest()?(this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this),Data.stage.removeEventListener(MainEvent.DISTORYACTION,this.destoryHandler,this),Data.stage.removeEventListener(MainEvent.FLASHACTION,this.flashActionHandler,this),this._ghost.gotoAndPlay("attack",1),this.playShockMusic(),this._symbolList.length=0,Data.life--,Data.stage.dispatchEvent(new MainEvent(MainEvent.ATTACKED)),Data.life<=0&&Data.stage.dispatchEvent(new MainEvent(MainEvent.GAMEOVER))):(this.y+=this._vy,this.x+=this._vx)},s.playDieMusic=function(){var t=RES.getRes("ghost_die_mp3");this._ghostDieChannel=t.play(3.2,1),this._ghostDieChannel.volume=.8},s.playShockMusic=function(){var t=RES.getRes("cat_beattack_mp3");this._catShockChannel=t.play(.5,1),this._catShockChannel.volume=.5},s.destoryHandler=function(t){Data.flashDetoryStatus||(Data.type==shapeType.FLASH?this._symbolList[0]==Data.type&&(Data.flashDetoryStatus=!0,Data.stage.dispatchEvent(new MainEvent(MainEvent.FLASHACTION))):this._symbolList[0]==Data.type&&(this._symbolList.shift(),this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this),this._symbolList.length>=1?(this._ghost.gotoAndPlay("shock",1),this.redrawSymbol()):(this.removeChild(this._shape),this._ghost.gotoAndPlay("die",1),this.playDieMusic(),Data.score+=this._score,Data.stage.dispatchEvent(new MainEvent(MainEvent.DISTORYGHOST)))))},s.flashActionHandler=function(t){Data.flashDetoryStatus&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this),this._symbolList.shift(),this._symbolList.length>=1?(this._ghost.gotoAndPlay("shock",1),this.redrawSymbol()):(this._shape.parent&&this.removeChild(this._shape),this._ghost.gotoAndPlay("die",1),Data.score+=this._score,Data.stage.dispatchEvent(new MainEvent(MainEvent.DISTORYGHOST))))},s.completeHandler=function(t){t.target instanceof Ghost&&(this._symbolList.length<1&&this.parent?this.parent.removeChild(this):(this._ghost.gotoAndStop("move"),this.addEventListener(egret.Event.ENTER_FRAME,this.move,this)))},s.hitPointTest=function(){if(this._dir){var t=Data.getStageH()/2-this.y-this.height/2-42,e=Data.getStageW()/2-this.x+this.width/2+52;if(Math.pow(e*e+t*t,.5)<50)return!0}else{var t=Data.getStageH()/2-this.y-this.height/2-42,e=Data.getStageW()/2-this.x-this.width/2-52;if(Math.pow(e*e+t*t,.5)<50)return!0}return!1},s.getRandomSymbol=function(){var t,e=[shapeType.HORIZONTAL,shapeType.VERTICAL,shapeType.LETTER_V,shapeType.REVERSED_LETTER_V,shapeType.FLASH],i=Data.baseSymbolNum+Math.ceil(Data.baseSymbolRandomNum*Math.random());this._score=50*i;for(var s=0;i>s;s++)t?t.push(e[Math.floor(5*Math.random())]):t=[e[Math.floor(5*Math.random())]];this._symbolList=t},e}(egret.DisplayObjectContainer);egret.registerClass(GhostContainer,"GhostContainer");var Background=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("main-stage_png"),t.width=Data.getStageW(),t.height=Data.getStageH(),this.addChild(t),this._cat=new Cat,this._cat.x=(Data.getStageW()+this._cat.width)/2,this._cat.y=(Data.getStageH()+this._cat.height)/2,this.addChild(this._cat),this._cat.stand(),this._txt=new egret.BitmapText,this._txt.font=RES.getRes("num_fnt"),this._txt.width=Data.getStageW()-30,this._txt.y=0,this._txt.textAlign="right",this._txt.text="score:"+Data.score.toString(),this.addChild(this._txt),this._life=new egret.Sprite,this.updateLife(),this._life.x=20,this._life.y=10,this.addChild(this._life),Data.stage.addEventListener(MainEvent.DISTORYACTION,this._cat.draw,this._cat),Data.stage.addEventListener(MainEvent.GAMEOVER,this._cat.die,this._cat),Data.stage.addEventListener(MainEvent.GAMEPAUSE,this._cat.stand,this._cat),Data.stage.addEventListener(MainEvent.DRAWSONG,this._cat.song,this._cat),Data.stage.addEventListener(MainEvent.FLASHACTION,this.playFlashShockMusic,this),Data.stage.addEventListener(MainEvent.CATSTAND,this._cat.stand,this._cat),Data.stage.addEventListener(MainEvent.ATTACKED,this._cat.shock,this._cat),Data.stage.addEventListener(MainEvent.DISTORYGHOST,this.updateScore,this),Data.stage.addEventListener(MainEvent.ATTACKED,this.updateLife,this)},s.updateScore=function(){this._txt.text="score:"+Data.score.toString()},s.playFlashShockMusic=function(){var t=RES.getRes("ghost_flash_shock_mp3");this._ghostFlashShockChannel=t.play(.8,1),this._ghostFlashShockChannel.volume=.5},s.updateLife=function(){var t;this._life.removeChildren();for(var e=0;e<Data.life;e++)t=new egret.Bitmap,t.texture=RES.getRes("life_png"),t.x=40*e,this._life.addChild(t)},e}(egret.DisplayObjectContainer);egret.registerClass(Background,"Background");var Loader=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){if(null==e.instance){var t=new e;e.instance=t}return e.instance},s.init=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){this.loadevent=new LoadEvent(LoadEvent.GROUP_PROGRESS),this.loadevent.groupName=t.groupName,this.loadevent.itemsLoaded=t.itemsLoaded,this.loadevent.itemsTotal=t.itemsTotal,this.dispatchEvent(this.loadevent),this.loadevent=null},s.onResourceLoadComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.loadevent=new LoadEvent(LoadEvent.GROUP_COMPLETE),this.loadevent.groupName=t.groupName,this.dispatchEvent(this.loadevent),this.loadevent=null},s.load=function(t){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(t)},e}(egret.EventDispatcher);egret.registerClass(Loader,"Loader");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=690,this.textField.height=360,this.textField.textAlign="center"},s.setProgress=function(t,e){var i="加载资源..."+(100*t/e).toFixed(2)+"%";this.textField.text=i},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){var t=new egret.DisplayObjectContainer;this.addChild(t),this._game=new Game(t),this._game.start()},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Shape=function(t){function e(e,i){t.call(this),this.init(e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t,e){switch(t){case shapeType.UNKONW_TYPE:break;case shapeType.HORIZONTAL:this.createHorizontal();break;case shapeType.VERTICAL:this.createVertical();break;case shapeType.LETTER_V:this.createLitterV();break;case shapeType.REVERSED_LETTER_V:this.createReversedLitterV();break;case shapeType.FLASH:this.createFlash(e)}},s.createHorizontal=function(){this.graphics.lineStyle(2,e.HORIZONTAL_COLOR),this.graphics.moveTo(0,4),this.graphics.lineTo(10,4)},s.createVertical=function(){this.graphics.lineStyle(2,e.VERTICAL_COLOR),this.graphics.moveTo(4,0),this.graphics.lineTo(4,10)},s.createLitterV=function(){this.graphics.lineStyle(2,e.LETTER_V_COLOR),this.graphics.moveTo(0,0),this.graphics.lineTo(5,10),this.graphics.lineTo(10,0)},s.createReversedLitterV=function(){this.graphics.lineStyle(2,e.REVERSED_LETTER_V_COLOR),this.graphics.moveTo(0,10),this.graphics.lineTo(5,0),this.graphics.lineTo(10,10)},s.createFlash=function(t){this.graphics.lineStyle(2,e.FLASH_COLOR),this.graphics.moveTo(5,0),t?(this.graphics.lineTo(8,5),this.graphics.lineTo(2,5),this.graphics.lineTo(5,10)):(this.graphics.lineTo(2,5),this.graphics.lineTo(8,5),this.graphics.lineTo(5,10))},e.UNKONW_TYPE_COLOR=0,e.HORIZONTAL_COLOR=16725815,e.VERTICAL_COLOR=3957759,e.LETTER_V_COLOR=16644096,e.REVERSED_LETTER_V_COLOR=655116,e.FLASH_COLOR=16565802,e}(egret.Shape);egret.registerClass(Shape,"Shape");var ShapeContainer=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){},s.create=function(t,e){for(var i,s=0,a=t.length;a>s;s++)i=new Shape(t[s],e),i.x=15*s,this.addChild(i)},s.redraw=function(t,e){this.removeChildren();for(var i,s=0,a=t.length;5>s&&a>s;s++)i=new Shape(t[s],e),i.x=15*s,this.addChild(i)},e}(egret.Sprite);egret.registerClass(ShapeContainer,"ShapeContainer");var SpellCanvas=function(t){function e(e,i){t.call(this),this.drawLineColor=0,this.width=e,this.height=i,this.addEventListener(egret.Event.ADDED,this.onAddedDisplayList,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddedDisplayList=function(t){this.graphics.beginFill(16777215,0),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchRealse,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchRealse,this)},s.onTouchBegin=function(t){this.touchPointID=t.touchPointID,this.points=[[t.stageX,t.stageY]],this.graphics.clear(),this.graphics.beginFill(16777215,0),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this.graphics.lineStyle(e.defaultDrawLineWidth,e.defaultDrawLineColor)},s.onTouchRealse=function(t){if(null!=this.touchPointID&&this.touchPointID==t.touchPointID){var e;this.touchPointID=null,e=this.points.map(function(t){return t});var i=new shapeRecognition;egret.log(i.judge(i.simplify(this.points)))}},s.onTouchMove=function(t){if(null!=this.touchPointID&&this.touchPointID==t.touchPointID){this.points.push([t.stageX,t.stageY]);var e=new shapeRecognition;this.shouldRedraw(e.judge(e.simplify(this.points))),this.connectPoints()}},s.connectPoints=function(){var t=this.points[this.points.length-1],e=this.points[this.points.length-2];this.graphics.moveTo(e[0],e[1]),this.graphics.lineTo(t[0],t[1])},s.shouldRedraw=function(t){var i=this.drawLineColor;switch(t){case shapeType.UNKONW_TYPE:i=e.defaultDrawLineColor;break;case shapeType.HORIZONTAL:i=16725815;break;case shapeType.VERTICAL:i=3957759;break;case shapeType.LETTER_V:i=16644096;break;case shapeType.REVERSED_LETTER_V:i=655116;break;case shapeType.FLASH:i=16565802}i!==this.drawLineColor&&(this.drawLineColor=i,this.graphics.lineStyle(e.defaultDrawLineWidth,this.drawLineColor),this.redrawPoints())},s.redrawPoints=function(){for(var t=this.points.length,e=0;t-1>e;e++)this.graphics.moveTo(this.points[e][0],this.points[e][1]),this.graphics.lineTo(this.points[e+1][0],this.points[e+1][1])},e.defaultDrawLineWidth=5,e.defaultDrawLineColor=0,e}(egret.Sprite);egret.registerClass(SpellCanvas,"SpellCanvas");var shapeType;!function(t){t[t.HORIZONTAL=2]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.LETTER_V=0]="LETTER_V",t[t.REVERSED_LETTER_V=3]="REVERSED_LETTER_V",t[t.FLASH=5]="FLASH",t[t.UNKONW_TYPE=-1]="UNKONW_TYPE"}(shapeType||(shapeType={}));var GestureShape=function(){function t(){this._bgColor=Shape.UNKONW_TYPE_COLOR,this._symbol=["28","46","82","64","141","585","3","7","5","1","4321876","2345678"],this._symbolG=[0,0,3,3,5,5,1,1,2,2,5,-1]}var e=(__define,t),i=e.prototype;return i.addEvent=function(t){this._layer=t,this._bg=new egret.Shape,this._line=new egret.Shape,this._layer.addChild(this._bg),this._layer.addChild(this._line),this.drawBackgroundColor(),Data.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),Data.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),Data.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},i.removeEvent=function(){Data.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),Data.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),Data.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},i.drawBackgroundColor=function(t){void 0===t&&(t=Shape.UNKONW_TYPE_COLOR),this._bg.graphics.clear(),this._bg.graphics.beginFill(t,1),this._bg.graphics.drawRect(0,0,Data.getStageW(),Data.getStageH()),this._bg.graphics.endFill(),this._bg.mask=this._line},i.mouseDown=function(t){this._line.graphics.clear(),this._mouseDatas=[];var e=new egret.Point(t.stageX,t.stageY);this._mouseDatas.push(e),this._currentPoint=e,Data.stage.dispatchEvent(new MainEvent(MainEvent.DRAWSONG))},i.mouseMove=function(t){var e=new egret.Point(t.stageX,t.stageY);this._mouseDatas.push(e),this._line.graphics.lineStyle(5,0),this._line.graphics.moveTo(this._currentPoint.x,this._currentPoint.y),this._line.graphics.lineTo(e.x,e.y),this._line.graphics.endFill(),this._currentPoint=e,this.shouldDrawBgColor(this.motion())},i.mouseUp=function(t){var e=new egret.Point(t.stageX,t.stageY);this._mouseDatas.push(e),this._line.graphics.clear(),this.disEvent(this.motion())},i.shouldDrawBgColor=function(t){var e;switch(t){case shapeType.HORIZONTAL:e=Shape.HORIZONTAL_COLOR;break;case shapeType.VERTICAL:e=Shape.VERTICAL_COLOR;break;case shapeType.LETTER_V:e=Shape.LETTER_V_COLOR;break;case shapeType.REVERSED_LETTER_V:e=Shape.REVERSED_LETTER_V_COLOR;break;case shapeType.FLASH:e=Shape.FLASH_COLOR;break;default:e=Shape.UNKONW_TYPE_COLOR}e!=this._bgColor&&(this.drawBackgroundColor(e),this._bgColor=e)},i.motion=function(){var t=[],e=0,i=this._mouseDatas.length;t.push(this._mouseDatas[e]);for(var s=0;i>s;s++)egret.Point.distance(this._mouseDatas[e],this._mouseDatas[s])>30&&(e=s,t.push(this._mouseDatas[e]));return this._mouseDatas=t,this.parseDirection()},i.parseDirection=function(){this._dirsArr=[];for(var t=this._mouseDatas.length,e=0;t>e;e++)if(this._mouseDatas[e+1]){var i=this._mouseDatas[e],s=this._mouseDatas[e+1],a=i.y-s.y,n=egret.Point.distance(i,s),h=Math.asin(a/n),r=57.29578*h,o=this.quadrant(i,s),d=this.getDirByAngQuad(r,o);this._dirsArr.push(d)}var c=this.repDiff(this._dirsArr),g=this.sweep(c);return g},i.disEvent=function(t){Data.type=t,-1!=t?(Data.flashDetoryStatus=!1,Data.stage.dispatchEvent(new MainEvent(MainEvent.DISTORYACTION,null,!0))):Data.stage.dispatchEvent(new MainEvent(MainEvent.CATSTAND))},i.sweep=function(t){for(var e=-1,i=-1,s=this._symbol.length,a=0;s>a;a++){var n=this.Levenshtein_Distance_Percent(this._symbol[a],t);n>i&&(i=n,e=this._symbolG[a])}return.25>i&&(e=-1),e},i.repDiff=function(t){for(var e="",i=t.length,s=0,a=0;i>a;a++)s!=t[a]&&(s=t[a],e+=t[a]);return e},i.getDirByAngQuad=function(t,e){switch(e){case 1:return 22.5>=t&&t>=0?1:67.5>=t&&t>22.5?8:7;case 2:return 22.5>=t&&t>=0?5:67.5>=t&&t>22.5?6:7;case 3:return-67.5>=t&&t>=-90?3:-22.5>=t&&t>-67.5?4:5;case 4:return-67.5>=t&&t>=-90?3:-22.5>=t&&t>-67.5?2:1}},i.quadrant=function(t,e){return e.x>=t.x?e.y<=t.y?1:4:e.y<=t.y?2:3},i.Levenshtein_Distance=function(t,e){var i,s,a,n,h,r=t.length,o=e.length,d=[];if(0==r)return o;if(0==o)return r;for(i=0;r>=i;i++)d[i]=[],d[i][0]=i;for(s=0;o>=s;s++)d[0][s]=s;for(i=1;r>=i;i++)for(a=t.charAt(i-1),s=1;o>=s;s++)n=e.charAt(s-1),h=a==n?0:1,d[i][s]=this.Minimum(d[i-1][s]+1,d[i][s-1]+1,d[i-1][s-1]+h);return d[r][o]},i.Levenshtein_Distance_Percent=function(t,e){var i=t.length>e.length?t.length:e.length,s=this.Levenshtein_Distance(t,e);return 1-s/i},i.Minimum=function(t,e,i){return e>t?i>t?t:i:i>e?e:i},t}();egret.registerClass(GestureShape,"GestureShape");var shapeRecognition=function(){function t(){}var e=(__define,t),i=e.prototype;return i.simplify=function(t){for(var e,i,s=[],a=!0,n=1,h=1;h<t.length;h++){var r=t[h-1],o=t[h],d=Math.atan2(o[1]-r[1],o[0]-r[0]);1==a?(i=r,a=!1,n=1):Math.abs(e-d)>1&&(a=!0,n>5&&s.push([i,r])),n++,e=d}return 0==a&&n>5&&s.push([i,t[t.length-1]]),s},i.quanrant=function(t){var e=Math.atan2(t[0][1]-t[1][1],t[1][0]-t[0][0]),i=Math.acos(-1),s=.2;return 0>e&&(e=2*i+e),Math.abs(e)<=s||Math.abs(e-i)<=s?-1:Math.abs(i/2-e)<=s||Math.abs(3*i/2-e)<=s?-2:e>=-s&&i/2+s>=e?0:e>i/2-s&&i+s>e?1:e>i-s&&3*i/2+s>e?2:3},i.judge=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.quanrant(t[i]));if(1==e.length)return-1==e[0]?shapeType.HORIZONTAL:-2==e[0]?shapeType.VERTICAL:shapeType.UNKONW_TYPE;if(2==e.length){if(3==e[0]&&0==e[1])return shapeType.LETTER_V;if(0==e[0]&&(3==e[1]||-2==e[1]))return shapeType.REVERSED_LETTER_V}else if(3==e.length){if(2==e[0]&&2==e[2])return shapeType.FLASH;if(2==e[0]&&1==e[2])return shapeType.UNKONW_TYPE}return shapeType.UNKONW_TYPE},t}();egret.registerClass(shapeRecognition,"shapeRecognition");